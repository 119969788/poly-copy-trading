# 🚨 私钥泄露紧急处理指南

## ⚠️ 立即行动清单

如果您怀疑私钥已经泄露，请**立即**执行以下步骤：

### 1. 立即停止使用该私钥的钱包

- ✅ **停止所有自动交易**
- ✅ **如果服务器正在运行，立即停止应用**
  ```bash
  pm2 stop poly-copy-trading
  # 或
  kill <进程ID>
  ```

### 2. 转移资金（如果钱包中有资金）

**这是最紧急的步骤！**

- ⚠️ **立即将钱包中的所有资金转移到新的安全钱包**
- ⚠️ **不要等待，立即行动**
- ⚠️ **使用 MetaMask 或其他钱包工具快速转移**

### 3. 检查私钥是否被提交到 Git

检查 Git 历史中是否包含私钥：

```bash
# 检查提交历史中是否有私钥
git log --all --full-history -p | grep -i "private_key\|0x[a-fA-F0-9]\{64,\}"

# 检查 .env 文件是否被提交
git log --all --source --full-history -- .env

# 检查当前仓库中是否有 .env 文件
git ls-files | grep "\.env$"
```

### 4. 如果私钥已提交到 GitHub

**如果私钥已经被推送到 GitHub，必须立即采取行动：**

#### 选项 A：更换私钥（如果可能）

1. 创建新钱包
2. 转移所有资金到新钱包
3. 使用新钱包的私钥

#### 选项 B：清理 Git 历史（复杂且可能无效）

⚠️ **警告**：GitHub 会保留所有历史记录，即使删除仓库也可能被恢复。

如果私钥已推送到 GitHub：
1. **立即删除 GitHub 仓库**（如果仓库是私有的）
2. **创建新仓库**
3. **使用新的私钥**

**重要**：即使从 Git 历史中删除，GitHub 的缓存和镜像可能仍然保留数据。

### 5. 检查代码中是否有硬编码的私钥

```bash
# 搜索代码中是否有私钥
grep -r "0x[a-fA-F0-9]\{64,\}" src/
grep -r "POLYMARKET_PRIVATE_KEY.*0x" .
```

### 6. 立即更改所有相关凭据

如果私钥已泄露：
- ✅ 更换钱包私钥（创建新钱包）
- ✅ 如果 GitHub 仓库是公开的，考虑删除并重建
- ✅ 检查是否有其他系统使用相同的私钥

## 预防措施

### ✅ 已实施的安全措施

1. **`.env` 文件已在 `.gitignore` 中** ✅
   - `.env` 文件不会被提交到 Git
   - 但是，如果之前手动添加过，可能仍在历史中

2. **使用环境变量** ✅
   - 私钥通过 `.env` 文件加载
   - 不硬编码在代码中

### 🔒 安全最佳实践

1. **永远不要提交 `.env` 文件**
   ```bash
   # 确认 .env 在 .gitignore 中
   cat .gitignore | grep "\.env"
   ```

2. **使用环境变量，不要硬编码**
   - ✅ 使用 `.env` 文件
   - ❌ 不要在代码中写死私钥

3. **使用专用钱包**
   - 为自动交易创建独立的钱包
   - 不要使用主要钱包的私钥

4. **定期轮换私钥**
   - 定期更换私钥
   - 使用新钱包进行交易

5. **限制资金**
   - 自动交易钱包只保留必要的资金
   - 不要存入过多资金

6. **监控钱包活动**
   - 定期检查钱包交易
   - 设置余额告警

## 检查清单

使用以下命令检查您的仓库安全状态：

```bash
# 1. 确认 .env 不在 Git 中
git ls-files | grep "\.env$"
# 应该没有输出

# 2. 检查 .gitignore 配置
cat .gitignore | grep -E "\.env|env\.local"
# 应该看到 .env

# 3. 检查代码中是否有硬编码私钥
grep -r "0x[a-fA-F0-9]\{64,\}" src/ package.json
# 应该没有输出

# 4. 检查 README 中是否有私钥示例（应该只是示例）
grep -i "private_key" README.md
# 应该只是示例，不是真实私钥
```

## 当前状态检查

让我检查您的仓库状态：

```bash
# 检查是否提交了 .env
git log --all --source --full-history -- .env

# 检查代码中是否有私钥
grep -r "POLYMARKET_PRIVATE_KEY.*=.*0x" . --exclude-dir=node_modules

# 检查 Git 历史中是否有私钥
git log -p | grep -i "0x[a-fA-F0-9]\{64,\}" | head -5
```

## 如果确认泄露

1. **立即转移资金** ⚠️
2. **停止所有使用该私钥的服务**
3. **创建新钱包**
4. **更新 `.env` 文件使用新私钥**
5. **如果已推送到 GitHub，考虑删除仓库重建**

## 联系方式

如果资金已被盗取：
- 立即报告给相关平台（Polymarket、钱包服务商等）
- 保留所有日志和证据
- 考虑向执法部门报告

---

**记住：私钥安全是加密货币安全的核心！永远不要分享、提交或暴露您的私钥！**
