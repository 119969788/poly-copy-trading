# 授权 USDC.e 给指定合约地址

## 功能说明

这个工具用于手动授权 USDC.e 给指定的合约地址（默认是 Polymarket CTF 合约）。

## 使用方法

### 基本用法

```bash
# 授权给默认合约（0x4d97dcd97ec945f40cf65f87097ace5ea0476045）
pnpm approve
```

### 授权给其他合约

在 `.env` 文件中设置：

```bash
APPROVE_CONTRACT_ADDRESS=0x你的合约地址
```

然后运行：

```bash
pnpm approve
```

## 默认授权地址

默认授权给 Polymarket CTF（Conditional Token Framework）合约：

```
0x4d97dcd97ec945f40cf65f87097ace5ea0476045
```

这是 Polymarket 用于处理条件代币的合约地址。

## 执行步骤

脚本会执行以下操作：

1. **检查钱包余额**
   - 显示 USDC.e 余额
   - 显示 MATIC 余额（用于 Gas 费）

2. **检查当前授权状态**
   - 显示是否已有授权
   - 显示授权额度

3. **执行授权**
   - 授权最大额度（无限）
   - 发送交易并等待确认

4. **验证授权**
   - 确认授权是否成功

## 输出示例

```
═══════════════════════════════════════════════════
   USDC.e 授权工具
═══════════════════════════════════════════════════

🚀 正在初始化...
钱包地址: 0x...
目标合约: 0x4d97dcd97ec945f40cf65f87097ace5ea0476045

💰 检查钱包余额...
   USDC.e 余额: 100.00 USDC
   MATIC 余额: 0.5000 MATIC

🔍 检查当前授权状态...
⚠️  需要授权
   问题: USDC.e allowance insufficient

🔐 准备授权...
   授权给: 0x4d97dcd97ec945f40cf65f87097ace5ea0476045
   授权额度: 无限（最大额度）

⚠️  即将执行授权交易...
   这将消耗少量 MATIC 作为 Gas 费

📝 正在发送授权交易...
✅ 授权交易已提交！
   已授权 1 个代币
   交易哈希: 0x...
   查看交易: https://polygonscan.com/tx/0x...
   等待交易确认（约 10-15 秒）...

🔍 验证授权状态...
✅ 授权验证成功！
   授权额度: 无限（最大额度）

═══════════════════════════════════════════════════
✅ 授权完成！
═══════════════════════════════════════════════════
```

## 注意事项

1. **Gas 费**
   - 授权需要消耗少量 MATIC 作为 Gas 费
   - 确保钱包中有足够的 MATIC（建议至少 0.1 MATIC）

2. **授权额度**
   - 默认授权最大额度（无限）
   - 这样就不需要频繁授权

3. **授权目标**
   - 默认授权给 CTF 合约
   - 这是 Polymarket 交易所需的授权

4. **授权状态**
   - 授权后，可以在 Polygonscan 上查看交易
   - 授权是永久性的，除非手动撤销

## 常见问题

### Q: 授权失败怎么办？

A: 检查：
1. 钱包余额是否足够（USDC.e 和 MATIC）
2. 网络连接是否正常
3. 私钥是否正确

### Q: 如何撤销授权？

A: 可以授权 0 额度来撤销，或使用钱包应用撤销授权。

### Q: 授权需要多长时间？

A: 通常在 10-15 秒内完成，取决于网络拥堵情况。

### Q: 授权后仍然报错？

A: 等待几秒让交易完全确认，然后重试。如果仍然失败，检查：
1. 授权交易是否已确认
2. 目标合约地址是否正确
3. 网络是否正常

## 相关文档

- [修复余额/授权错误](./FIX_BALANCE_ALLOWANCE.md)
- [快速修复指南](./FIX_BALANCE_ALLOWANCE_QUICK.md)
