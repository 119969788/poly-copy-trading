# 实盘批量卖出指南

## ⚠️ 重要警告

**实盘卖出会真实执行交易，操作不可撤销！**

在切换到实盘模式前，请确保：
- ✅ 已在模拟模式下查看过持仓
- ✅ 确认要卖出的持仓列表
- ✅ 理解卖出操作的风险
- ✅ 钱包中有足够的 MATIC 作为 Gas 费（如果需要）

## 切换到实盘模式

### 在服务器上

```bash
# 1. 进入项目目录
cd ~/projects/poly-copy-trading

# 2. 编辑 .env 文件
nano .env

# 3. 设置 DRY_RUN=false
# 找到 DRY_RUN=true 或添加：
DRY_RUN=false

# 4. 保存文件（Ctrl+O, Enter, Ctrl+X）

# 5. 验证设置
grep DRY_RUN .env
```

### 在本地

```bash
# 编辑 .env 文件
# Windows: notepad .env
# Mac/Linux: nano .env

# 设置
DRY_RUN=false
```

## 执行批量卖出

### 在服务器上

```bash
cd ~/projects/poly-copy-trading

# 运行批量卖出
pnpm batch-sell

# 或直接使用 tsx
pnpm tsx src/batch-sell.ts
```

### 在本地

```bash
pnpm batch-sell
```

## 卖出流程

1. **初始化 SDK** - 连接 Polymarket
2. **获取持仓** - 自动获取所有持仓
3. **显示持仓信息** - 列出所有持仓详情
4. **确认警告** - 显示实盘模式警告
5. **批量卖出** - 逐个卖出所有持仓
6. **显示结果** - 统计成功/失败数量

## 输出示例

```
═══════════════════════════════════════════════════
   Polymarket 批量卖出代币工具
═══════════════════════════════════════════════════

🚀 正在初始化 SDK...
✅ SDK 初始化成功

钱包地址: 0x4599C8C95853A01c3E6d1DEe6cC2da1716c0cBA0

📊 正在获取持仓信息...

找到 3 个持仓，其中 3 个有余额可卖出：

持仓 #1:
   市场: will-trump-win-2024
   条件ID: 0x1234...
   代币ID: 0x5678...
   数量: 100
   方向: YES
   价值: $45.00
   PnL: $5.00

⚠️  警告：即将卖出所有持仓！
   模式: 💰 实盘模式
   持仓数量: 3

🔄 开始批量卖出...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
卖出持仓 #1/3
   市场: will-trump-win-2024
   条件ID: 0x1234...
   代币ID: 0x5678...
   数量: 100
   方向: YES
   状态: ✅ 成功
   订单ID: order_12345
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

...

═══════════════════════════════════════════════════
📊 卖出结果统计
═══════════════════════════════════════════════════

总持仓数: 3
成功卖出: 3
失败: 0
```

## 安全建议

### 1. 先模拟测试

```bash
# 先设置为模拟模式
DRY_RUN=true

# 运行查看持仓
pnpm batch-sell

# 确认无误后再切换实盘
DRY_RUN=false
```

### 2. 分批卖出（可选）

如果持仓很多，可以修改脚本分批卖出，或手动选择特定持仓。

### 3. 监控卖出过程

- 观察每个卖出操作的结果
- 检查是否有失败的交易
- 确认订单ID和状态

### 4. 检查余额

卖出后检查钱包余额：

```bash
# 在脚本中会显示余额，或手动检查
# 卖出后资金会以 USDC 形式存入账户
```

## 常见问题

### Q: 卖出失败怎么办？

A: 脚本会继续处理其他持仓，最后会显示失败列表。可以：
- 查看错误信息
- 手动重试失败的持仓
- 检查市场是否已关闭
- 检查网络连接

### Q: 卖出后资金在哪里？

A: 卖出后，资金会以 USDC 形式存入您的 Polymarket 账户余额。

### Q: 可以撤销卖出吗？

A: 市场订单一旦成交无法撤销。如果是限价订单，可以在成交前取消。

### Q: 需要 Gas 费吗？

A: 在链下 CLOB 交易，卖出代币本身不需要 Gas 费。但如果需要将代币转换为 USDC 可能需要 Gas 费。

### Q: 卖出后如何查看余额？

A: 可以在 Polymarket 网站上查看，或使用 SDK 的余额查询功能。

## 快速检查清单

- [ ] 已在模拟模式下查看持仓
- [ ] 确认要卖出的持仓列表
- [ ] 理解卖出操作不可撤销
- [ ] 已设置 `DRY_RUN=false`
- [ ] 钱包中有足够的 MATIC（如果需要）
- [ ] 网络连接正常
- [ ] 已准备好监控卖出过程

## 紧急停止

如果需要在卖出过程中停止：

```bash
# 按 Ctrl+C 停止脚本
# 已卖出的订单无法撤销
# 未处理的持仓不会继续卖出
```

---

**最后提醒**：实盘卖出是真实交易，请谨慎操作！
