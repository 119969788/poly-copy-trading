# 15分钟市场暴跌套利策略 - 参数设置指南

## 📋 参数总览

所有参数都在 `.env` 文件中配置：

```env
# ===== 15分钟市场暴跌套利策略配置 =====
# 币种（ETH, BTC 等）
COIN=ETH

# Leg1 滑动窗口（毫秒，默认 3000，即3秒）
SLIDING_WINDOW_MS=3000

# Leg1 暴跌阈值（0.3 表示 30%，默认 0.3）
DIP_THRESHOLD=0.3

# Leg2 成本目标（默认 0.95，即用 0.95 USDC 获得 1 USDC）
SUM_TARGET=0.95

# Leg2 止损时间（秒，默认 100，100秒后如果leg2未执行自动卖出leg1）
LEG2_TIMEOUT_SECONDS=100
```

---

## 🔍 参数详细说明

### 1. COIN（币种）

**作用**：选择要监控的币种市场

**可选值**：
- `ETH` - 以太坊（默认）
- `BTC` - 比特币
- 其他支持的币种

**示例**：
```env
COIN=ETH
```

**调优建议**：
- ETH 市场通常流动性更好，信号更多
- BTC 市场波动可能更大，需要调整其他参数

---

### 2. SLIDING_WINDOW_MS（滑动窗口）

**作用**：检测暴跌的时间窗口（毫秒）

**默认值**：`3000`（3秒）

**含义**：在这个时间窗口内检测价格暴跌

**示例**：
```env
SLIDING_WINDOW_MS=3000  # 3秒内检测暴跌
SLIDING_WINDOW_MS=2000  # 2秒内检测暴跌（更敏感）
SLIDING_WINDOW_MS=5000  # 5秒内检测暴跌（更宽松）
```

**调优建议**：
- **较小值（2000-3000ms）**：更敏感，能捕捉快速暴跌，但可能误报
- **较大值（4000-5000ms）**：更宽松，减少误报，但可能错过快速机会
- **推荐**：3000ms（3秒）是平衡点

**影响**：
- 窗口越小，信号越频繁，但可能包含噪音
- 窗口越大，信号越少，但更可靠

---

### 3. DIP_THRESHOLD（暴跌阈值）

**作用**：触发买入信号的暴跌幅度

**默认值**：`0.3`（30%）

**含义**：价格在滑动窗口内下跌超过这个百分比时触发买入

**示例**：
```env
DIP_THRESHOLD=0.3   # 30%暴跌（默认）
DIP_THRESHOLD=0.25  # 25%暴跌（更保守）
DIP_THRESHOLD=0.2   # 20%暴跌（更激进）
DIP_THRESHOLD=0.35  # 35%暴跌（更保守）
```

**调优建议**：
- **较小值（0.2-0.25）**：更频繁的信号，但可能不是真正的暴跌
- **中等值（0.3）**：平衡点，推荐使用
- **较大值（0.35-0.4）**：更保守，信号更少但更可靠

**影响**：
- 阈值越小，信号越多，但可能包含假信号
- 阈值越大，信号越少，但信号质量更高

**⚠️ 注意**：
- 15分钟市场有手续费，不建议使用太小的阈值（如0.2）
- 频繁交易会产生大量手续费，侵蚀利润

---

### 4. SUM_TARGET（成本目标）

**作用**：Leg2 的利润目标

**默认值**：`0.95`（用 0.95 USDC 获得 1 USDC，即 5% 利润）

**含义**：花费多少 USDC 来获得 1 USDC 的持仓

**示例**：
```env
SUM_TARGET=0.95  # 用0.95获得1（5%利润，默认）
SUM_TARGET=0.93  # 用0.93获得1（7%利润，更保守）
SUM_TARGET=0.97  # 用0.97获得1（3%利润，更激进）
SUM_TARGET=0.90  # 用0.90获得1（10%利润，非常保守）
```

**调优建议**：
- **较小值（0.90-0.93）**：更高的利润目标，但可能难以达成
- **中等值（0.95）**：平衡点，推荐使用
- **较大值（0.97-0.98）**：更低的利润目标，更容易达成但利润较少

**影响**：
- 目标越小（如0.90），利润越高，但可能需要等待更长时间
- 目标越大（如0.97），利润越低，但更容易快速达成

**⚠️ 注意**：
- 考虑手续费后，实际利润会减少
- 如果手续费是 1%，那么 0.95 的目标实际利润只有 4%
- 建议设置至少 0.93 以上，确保扣除手续费后仍有利润

---

### 5. LEG2_TIMEOUT_SECONDS（止损时间）

**作用**：Leg2 的超时时间（秒）

**默认值**：`100`（100秒）

**含义**：如果在这个时间内 Leg2 未执行，自动卖出 Leg1 防止持仓归零

**示例**：
```env
LEG2_TIMEOUT_SECONDS=100  # 100秒止损（默认）
LEG2_TIMEOUT_SECONDS=120  # 120秒止损（更宽松）
LEG2_TIMEOUT_SECONDS=60   # 60秒止损（更激进）
LEG2_TIMEOUT_SECONDS=150  # 150秒止损（非常宽松）
```

**调优建议**：
- **较小值（60-80秒）**：更快止损，减少风险，但可能错过机会
- **中等值（100秒）**：平衡点，推荐使用
- **较大值（120-150秒）**：更宽松，给 Leg2 更多时间，但风险增加

**影响**：
- 时间越短，止损越快，风险越小，但可能错过一些机会
- 时间越长，给 Leg2 更多时间，但持仓归零的风险增加

**⚠️ 注意**：
- 15分钟市场只有15分钟，如果设置太长时间（如200秒），可能接近市场结束
- 建议设置在 60-120 秒之间

---

## 📊 推荐配置方案

### 🟢 保守配置（推荐新手）

**特点**：信号少但质量高，利润目标高，风险低

```env
COIN=ETH
SLIDING_WINDOW_MS=3000      # 3秒窗口
DIP_THRESHOLD=0.25          # 25%暴跌（更保守）
SUM_TARGET=0.93             # 7%利润目标
LEG2_TIMEOUT_SECONDS=120    # 120秒止损
```

**适用场景**：
- 首次使用
- 资金量较大
- 追求稳定收益
- 不想频繁交易

**优点**：
- 信号质量高
- 利润目标高
- 风险低
- 手续费成本低

**缺点**：
- 信号较少
- 可能需要等待较长时间

---

### 🟡 中等配置（推荐）

**特点**：平衡信号频率和利润，适合大多数用户

```env
COIN=ETH
SLIDING_WINDOW_MS=3000      # 3秒窗口
DIP_THRESHOLD=0.3           # 30%暴跌（默认）
SUM_TARGET=0.95             # 5%利润目标
LEG2_TIMEOUT_SECONDS=100    # 100秒止损
```

**适用场景**：
- 有一定经验
- 追求平衡
- 大多数用户

**优点**：
- 信号频率适中
- 利润目标合理
- 风险可控
- 平衡点

**缺点**：
- 需要根据市场情况调整

---

### 🟠 激进配置（不推荐）

**特点**：信号频繁，利润目标低，风险高

```env
COIN=ETH
SLIDING_WINDOW_MS=2000      # 2秒窗口（更敏感）
DIP_THRESHOLD=0.2           # 20%暴跌（更频繁）
SUM_TARGET=0.97             # 3%利润目标
LEG2_TIMEOUT_SECONDS=60     # 60秒止损
```

**适用场景**：
- 经验丰富
- 资金量小
- 愿意承担高风险

**⚠️ 警告**：
- 15分钟市场有手续费，频繁交易会产生大量手续费
- 可能侵蚀利润甚至亏损
- **不推荐使用**

**缺点**：
- 手续费成本高
- 可能亏损
- 信号质量可能较低

---

## 🎯 参数调优建议

### 1. 根据市场波动调整

**高波动市场**（如 BTC）：
```env
DIP_THRESHOLD=0.35          # 提高阈值，减少假信号
SUM_TARGET=0.93             # 提高利润目标
LEG2_TIMEOUT_SECONDS=120    # 增加止损时间
```

**低波动市场**（如 ETH）：
```env
DIP_THRESHOLD=0.3           # 标准阈值
SUM_TARGET=0.95             # 标准利润目标
LEG2_TIMEOUT_SECONDS=100    # 标准止损时间
```

### 2. 根据资金量调整

**大资金**（> $1000）：
```env
DIP_THRESHOLD=0.25          # 更保守，追求质量
SUM_TARGET=0.93             # 更高利润目标
```

**小资金**（< $100）：
```env
DIP_THRESHOLD=0.3           # 标准配置
SUM_TARGET=0.95             # 标准利润目标
```

### 3. 根据手续费调整

**如果手续费较高**（> 1%）：
```env
SUM_TARGET=0.92             # 提高利润目标，补偿手续费
DIP_THRESHOLD=0.25          # 减少交易频率
```

**如果手续费较低**（< 0.5%）：
```env
SUM_TARGET=0.95             # 标准利润目标
DIP_THRESHOLD=0.3           # 标准配置
```

---

## 📈 参数组合效果

### 高频低利润组合（不推荐）

```env
SLIDING_WINDOW_MS=2000
DIP_THRESHOLD=0.2
SUM_TARGET=0.98
LEG2_TIMEOUT_SECONDS=60
```

**效果**：信号频繁，但利润低，手续费成本高

### 低频高利润组合（推荐）

```env
SLIDING_WINDOW_MS=3000
DIP_THRESHOLD=0.25
SUM_TARGET=0.93
LEG2_TIMEOUT_SECONDS=120
```

**效果**：信号少但质量高，利润高，手续费成本低

### 平衡组合（推荐）

```env
SLIDING_WINDOW_MS=3000
DIP_THRESHOLD=0.3
SUM_TARGET=0.95
LEG2_TIMEOUT_SECONDS=100
```

**效果**：信号频率和利润平衡

---

## ⚠️ 重要提示

1. **首次使用建议模拟模式**
   ```env
   DRY_RUN=true
   ```

2. **参数需要根据实际效果调整**
   - 观察信号频率
   - 观察实际利润
   - 观察手续费成本
   - 根据结果调整参数

3. **15分钟市场有手续费**
   - 不要使用太激进的参数
   - 频繁交易会产生大量手续费
   - 建议使用保守或中等配置

4. **定期检查统计信息**
   - 查看信号检测数量
   - 查看 Leg1/Leg2 执行数量
   - 查看实际利润
   - 根据数据调整参数

---

## 🔧 快速配置模板

### 模板1：保守配置（复制到 .env）

```env
COIN=ETH
SLIDING_WINDOW_MS=3000
DIP_THRESHOLD=0.25
SUM_TARGET=0.93
LEG2_TIMEOUT_SECONDS=120
```

### 模板2：中等配置（复制到 .env）

```env
COIN=ETH
SLIDING_WINDOW_MS=3000
DIP_THRESHOLD=0.3
SUM_TARGET=0.95
LEG2_TIMEOUT_SECONDS=100
```

---

## 📚 相关文档

- [完整策略指南](./DIP_ARB_GUIDE.md)
- [参数配置示例](./env.example.txt)
- [策略代码](./src/dip-arb-15m.ts)

---

**提示**：参数调优是一个持续的过程，建议先用模拟模式测试不同参数组合，找到最适合你资金量和风险偏好的配置！
